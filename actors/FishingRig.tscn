[gd_scene load_steps=47 format=3 uid="uid://c05klp7s2dqe8"]

[ext_resource type="SpriteFrames" uid="uid://dsfp4gvdeeesr" path="res://assets/animations/player_frames.tres" id="2_reoop"]
[ext_resource type="PackedScene" uid="uid://cdacpta6ojrdb" path="res://actors/DirectionSelector.tscn" id="3_yye3u"]
[ext_resource type="PackedScene" uid="uid://c10e4ohc4jrv6" path="res://actors/PowerMeter.tscn" id="4_dfqbx"]
[ext_resource type="Script" uid="uid://bkfgyd8su4uiv" path="res://systems/fishing_controller.gd" id="4_kb1vm"]
[ext_resource type="Script" uid="uid://xexkbrrdqbe6" path="res://zones/killzone.gd" id="7_460ac"]

[sub_resource type="GDScript" id="GDScript_yye3u"]
script/source = "extends Node3D

@onready var fishing_manager = $FishingManager

func _ready():
	# Optional: call fishing manager setup if needed
	fishing_manager._ready()

func _process(delta):
	fishing_manager._process(delta)

func _unhandled_input(event: InputEvent):
	fishing_manager.handle_input(event)
"

[sub_resource type="Animation" id="Animation_52vux"]
length = 0.001

[sub_resource type="Animation" id="Animation_reoop"]
length = 0.125
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["fishing_idle"]
}

[sub_resource type="Animation" id="Animation_2djwe"]
length = 2.125
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.125, 0.25, 0.375, 0.5, 0.625, 0.75, 0.875, 1, 1.125, 1.25, 1.375, 1.5, 1.625, 1.75, 1.875, 2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["prep_fishing"]
}

[sub_resource type="Animation" id="Animation_4jfb6"]
length = 0.5
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.125, 0.25, 0.375),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["reeling_idle"]
}

[sub_resource type="Animation" id="Animation_yevqy"]
length = 0.125
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["reeling_idle_left"]
}

[sub_resource type="Animation" id="Animation_sxlqi"]
length = 0.125
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["reeling_idle_right"]
}

[sub_resource type="Animation" id="Animation_460ac"]
length = 0.5
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.125, 0.25, 0.375),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["reeling_left"]
}

[sub_resource type="Animation" id="Animation_ali1n"]
length = 0.5
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.125, 0.25, 0.375),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["reeling_right"]
}

[sub_resource type="Animation" id="Animation_aoiyr"]
length = 0.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["reeling_static"]
}

[sub_resource type="Animation" id="Animation_60w1x"]
length = 0.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["throw_idle"]
}

[sub_resource type="Animation" id="Animation_0nu4v"]
length = 0.642857
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.0714286, 0.142857, 0.214286, 0.285714, 0.357143, 0.428571, 0.5, 0.571429),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["throw_line"]
}

[sub_resource type="Animation" id="Animation_jwcha"]
length = 0.785714
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.0714286, 0.142857, 0.214286, 0.285714, 0.357143, 0.428571, 0.5, 0.571429, 0.642857, 0.714286),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["throw_line_finish"]
}
tracks/2/type = "method"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0.266667),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [0.0],
"method": &"spawn_bait"
}]
}

[sub_resource type="Animation" id="Animation_ooxxp"]
length = 0.0714286
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("AnimatedSprite3D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("AnimatedSprite3D:animation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": ["throw_line_idle"]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_a83gf"]
_data = {
&"RESET": SubResource("Animation_52vux"),
&"fishing_idle": SubResource("Animation_reoop"),
&"prep_fishing": SubResource("Animation_2djwe"),
&"reeling_idle": SubResource("Animation_4jfb6"),
&"reeling_idle_left": SubResource("Animation_yevqy"),
&"reeling_idle_right": SubResource("Animation_sxlqi"),
&"reeling_left": SubResource("Animation_460ac"),
&"reeling_right": SubResource("Animation_ali1n"),
&"reeling_static": SubResource("Animation_aoiyr"),
&"throw_idle": SubResource("Animation_60w1x"),
&"throw_line": SubResource("Animation_0nu4v"),
&"throw_line_finish": SubResource("Animation_jwcha"),
&"throw_line_idle": SubResource("Animation_ooxxp")
}

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_jrod8"]
animation = &"fishing_idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ucsik"]
animation = &"prep_fishing"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_sxlqi"]
animation = &"reeling_idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_460ac"]
animation = &"reeling_idle_left"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ali1n"]
animation = &"reeling_idle_right"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_aoiyr"]
animation = &"reeling_left"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_60w1x"]
animation = &"reeling_right"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0nu4v"]
animation = &"reeling_static"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_reoop"]
animation = &"throw_idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2djwe"]
animation = &"throw_line"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_4jfb6"]
animation = &"throw_line_finish"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_yevqy"]
animation = &"throw_line_idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_11qcf"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_reoop"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2djwe"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_4jfb6"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_yevqy"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_jwcha"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ooxxp"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_a83gf"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_jrod8"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ucsik"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_borun"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_8eai5"]
advance_mode = 0

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_8eai5"]
states/End/position = Vector2(1124, 210)
states/Start/position = Vector2(122, 90)
states/fishing_idle/node = SubResource("AnimationNodeAnimation_jrod8")
states/fishing_idle/position = Vector2(406, 90)
states/prep_fishing/node = SubResource("AnimationNodeAnimation_ucsik")
states/prep_fishing/position = Vector2(252, 90)
states/reeling_idle/node = SubResource("AnimationNodeAnimation_sxlqi")
states/reeling_idle/position = Vector2(1002, 215)
states/reeling_idle_left/node = SubResource("AnimationNodeAnimation_460ac")
states/reeling_idle_left/position = Vector2(906, 289)
states/reeling_idle_right/node = SubResource("AnimationNodeAnimation_ali1n")
states/reeling_idle_right/position = Vector2(1110, 289)
states/reeling_left/node = SubResource("AnimationNodeAnimation_aoiyr")
states/reeling_left/position = Vector2(906, 361)
states/reeling_right/node = SubResource("AnimationNodeAnimation_60w1x")
states/reeling_right/position = Vector2(1110, 361)
states/reeling_static/node = SubResource("AnimationNodeAnimation_0nu4v")
states/reeling_static/position = Vector2(1002, 153)
states/throw_idle/node = SubResource("AnimationNodeAnimation_reoop")
states/throw_idle/position = Vector2(1002, 90)
states/throw_line/node = SubResource("AnimationNodeAnimation_2djwe")
states/throw_line/position = Vector2(546, 90)
states/throw_line_finish/node = SubResource("AnimationNodeAnimation_4jfb6")
states/throw_line_finish/position = Vector2(854, 90)
states/throw_line_idle/node = SubResource("AnimationNodeAnimation_yevqy")
states/throw_line_idle/position = Vector2(694, 90)
transitions = ["Start", "prep_fishing", SubResource("AnimationNodeStateMachineTransition_11qcf"), "prep_fishing", "fishing_idle", SubResource("AnimationNodeStateMachineTransition_reoop"), "fishing_idle", "throw_line", SubResource("AnimationNodeStateMachineTransition_2djwe"), "throw_line", "throw_line_idle", SubResource("AnimationNodeStateMachineTransition_4jfb6"), "throw_line_idle", "throw_line_finish", SubResource("AnimationNodeStateMachineTransition_yevqy"), "throw_line_finish", "throw_idle", SubResource("AnimationNodeStateMachineTransition_jwcha"), "throw_idle", "reeling_static", SubResource("AnimationNodeStateMachineTransition_ooxxp"), "reeling_static", "reeling_idle", SubResource("AnimationNodeStateMachineTransition_a83gf"), "reeling_idle", "reeling_idle_left", SubResource("AnimationNodeStateMachineTransition_jrod8"), "reeling_idle_left", "reeling_left", SubResource("AnimationNodeStateMachineTransition_ucsik"), "reeling_idle", "reeling_idle_right", SubResource("AnimationNodeStateMachineTransition_borun"), "reeling_idle_right", "reeling_right", SubResource("AnimationNodeStateMachineTransition_8eai5")]
graph_offset = Vector2(344, 6)

[sub_resource type="SphereShape3D" id="SphereShape3D_sxlqi"]

[node name="FishingRig" type="Node3D"]
script = SubResource("GDScript_yye3u")

[node name="BaitSpawn" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.296712, 1.35307, 0)

[node name="AnimatedSprite3D" type="AnimatedSprite3D" parent="."]
transform = Transform3D(2.48, 0, 0, 0, 2.48, 0, 0, 0, 2.48, 0, 0, 0)
centered = false
offset = Vector2(-100, -69)
billboard = 1
alpha_cut = 1
texture_filter = 0
sprite_frames = ExtResource("2_reoop")
animation = &"prep_fishing"
frame = 16

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_a83gf")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_8eai5")
anim_player = NodePath("../AnimationPlayer")

[node name="BaitTarget" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.831814, 0, -0.445473)

[node name="FishingController" type="Node" parent="."]
script = ExtResource("4_kb1vm")

[node name="DirectionSelector" parent="FishingController" instance=ExtResource("3_yye3u")]

[node name="PowerMeter" parent="FishingController" instance=ExtResource("4_dfqbx")]

[node name="Killzone" type="Area3D" parent="FishingController" node_paths=PackedStringArray("fishing_manager")]
collision_layer = 2
collision_mask = 16
script = ExtResource("7_460ac")
fishing_manager = NodePath("")

[node name="CollisionShape3D" type="CollisionShape3D" parent="FishingController/Killzone"]
transform = Transform3D(3, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0)
shape = SubResource("SphereShape3D_sxlqi")

[connection signal="body_entered" from="FishingController/Killzone" to="." method="_on_killzone_body_entered"]
